import{A as I}from"./audio-1a7b1538.js";import{U as k}from"./ui-de6bd2fa.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class T{constructor(){this.apiEndpoint="",this.sessionId="",this.playerName="",this.countryFlag="ðŸŒ",this.localScores=[],this.dailyChallenges=new Map,this.sessionNonce="",this.secretKey="",this.recordingGhost=!1,this.currentGhostData=null,this.recordingStartTime=0,this.leaderboardCache=new Map,this.cacheExpiry=5*60*1e3,this.initializeSession(),this.detectUserLocation(),this.loadLocalData()}async initialize(){try{this.apiEndpoint=this.getApiEndpoint(),await this.initializeSession(),await this.loadTodaysChallenge(),console.log("Leaderboard system initialized")}catch(t){console.warn("Leaderboard initialization failed, using offline mode:",t)}}getApiEndpoint(){return"/api"}async initializeSession(){try{this.sessionId=this.generateSessionId(),this.playerName=localStorage.getItem("flappydog-playername")||this.generatePlayerName();const t=await fetch(`${this.apiEndpoint}/session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:this.sessionId})});if(t.ok){const e=await t.json();this.sessionNonce=e.nonce,this.secretKey=e.key}}catch(t){console.warn("Failed to initialize server session, using offline mode:",t),this.sessionNonce=this.generateNonce()}}detectUserLocation(){try{const t=Intl.DateTimeFormat().resolvedOptions().timeZone;this.countryFlag=this.getCountryFlagFromTimezone(t)}catch(t){this.countryFlag="ðŸŒ"}}getCountryFlagFromTimezone(t){return{"America/New_York":"ðŸ‡ºðŸ‡¸","America/Los_Angeles":"ðŸ‡ºðŸ‡¸","America/Chicago":"ðŸ‡ºðŸ‡¸","Europe/London":"ðŸ‡¬ðŸ‡§","Europe/Paris":"ðŸ‡«ðŸ‡·","Europe/Berlin":"ðŸ‡©ðŸ‡ª","Asia/Tokyo":"ðŸ‡¯ðŸ‡µ","Asia/Shanghai":"ðŸ‡¨ðŸ‡³","Asia/Seoul":"ðŸ‡°ðŸ‡·","Australia/Sydney":"ðŸ‡¦ðŸ‡º","America/Toronto":"ðŸ‡¨ðŸ‡¦","America/Mexico_City":"ðŸ‡²ðŸ‡½","America/Sao_Paulo":"ðŸ‡§ðŸ‡·","Europe/Rome":"ðŸ‡®ðŸ‡¹","Europe/Madrid":"ðŸ‡ªðŸ‡¸","Asia/Mumbai":"ðŸ‡®ðŸ‡³","Asia/Singapore":"ðŸ‡¸ðŸ‡¬"}[t]||"ðŸŒ"}loadLocalData(){const t=localStorage.getItem("flappydog-local-scores");t&&(this.localScores=JSON.parse(t));const e=localStorage.getItem("flappydog-daily-challenges");e&&JSON.parse(e).forEach(s=>{this.dailyChallenges.set(s.date,s)})}saveLocalData(){localStorage.setItem("flappydog-local-scores",JSON.stringify(this.localScores));const t=Array.from(this.dailyChallenges.values());localStorage.setItem("flappydog-daily-challenges",JSON.stringify(t))}startGhostRecording(){this.recordingGhost=!0,this.recordingStartTime=Date.now(),this.currentGhostData={positions:[],events:[],duration:0,checksum:""}}recordGhostPosition(t,e,i){if(!this.recordingGhost||!this.currentGhostData)return;const s=Date.now()-this.recordingStartTime;(this.currentGhostData.positions.length===0||s-this.currentGhostData.positions[this.currentGhostData.positions.length-1].time>=33)&&this.currentGhostData.positions.push({time:s,x:t,y:e,rotation:i})}recordGhostEvent(t,e){if(!this.recordingGhost||!this.currentGhostData)return;const i=Date.now()-this.recordingStartTime;this.currentGhostData.events.push({time:i,type:t,data:e})}stopGhostRecording(){if(!this.recordingGhost||!this.currentGhostData)return null;this.recordingGhost=!1,this.currentGhostData.duration=Date.now()-this.recordingStartTime,this.currentGhostData.checksum=this.generateGhostChecksum(this.currentGhostData);const t=this.currentGhostData;return this.currentGhostData=null,t}generateGhostChecksum(t){const e=JSON.stringify({positionCount:t.positions.length,eventCount:t.events.length,duration:t.duration,firstPosition:t.positions[0],lastPosition:t.positions[t.positions.length-1]});return this.simpleHash(e)}async submitScore(t,e,i,s="classic"){try{const a=this.analyzeGhostData(i);if(!this.validateScore(t,a))return console.warn("Score failed anti-cheat validation"),!1;const n={id:this.generateEntryId(),playerName:this.playerName,score:t,timestamp:Date.now(),seed:e,flag:this.countryFlag,gameMode:s,verified:!0,ghostData:i};return this.addLocalScore(n),await this.submitToServer(n)&&(this.leaderboardCache.clear(),console.log("Score submitted successfully")),!0}catch(a){return console.warn("Score submission failed:",a),!1}}async submitToServer(t){if(!this.apiEndpoint)return!1;try{const e={score:t.score,seed:t.seed,gameMode:t.gameMode,ghostData:t.ghostData,playerName:t.playerName,timestamp:t.timestamp,sessionId:this.sessionId,signature:this.signSubmission(t)},i=await fetch(`${this.apiEndpoint}/submit-score`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.ok)return(await i.json()).success;{const s=await i.text();return console.warn("Server rejected score submission:",s),!1}}catch(e){return console.warn("Network error during score submission:",e),!1}}signSubmission(t){const e=`${t.score}:${t.seed}:${t.timestamp}:${this.sessionNonce}`;return this.simpleHash(e+this.secretKey)}addLocalScore(t){this.localScores.push(t),this.localScores.sort((e,i)=>i.score-e.score),this.localScores=this.localScores.slice(0,100),this.saveLocalData()}analyzeGhostData(t){let e=0,i=0,s=0;const a=t.events.filter(h=>h.type==="flap");if(a.length>1){const h=[];for(let c=1;c<a.length;c++)h.push(a[c].time-a[c-1].time);h.sort((c,r)=>c-r),e=h.length>0?1e3/h[0]:0}for(let h=1;h<t.positions.length;h++){const c=t.positions[h-1],r=t.positions[h],m=r.time-c.time,S=Math.sqrt(Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2)),d=1e3;m>0&&S/(m/1e3)>d&&i++,(r.x<-100||r.x>900||r.y<-100||r.y>700)&&i++}for(let h=1;h<t.positions.length;h++)t.positions[h].time<=t.positions[h-1].time&&s++;const n=t.events.filter(h=>h.type==="score").length,o=Math.abs(n-Math.floor(n))<.1?1:0;return{maxFlapRate:e,impossiblePositions:i,timeInconsistencies:s,scoreConsistency:o}}validateScore(t,e){return!(e.maxFlapRate>20||e.impossiblePositions>5||e.timeInconsistencies>10||t<0||t>1e4)}async getLeaderboard(t,e=50){const i=`${t}-${e}`,s=this.leaderboardCache.get(i);if(s&&Date.now()-s.timestamp<this.cacheExpiry)return s.data;try{const a=await this.fetchFromServer(t,e);if(a.length>0)return this.leaderboardCache.set(i,{data:a,timestamp:Date.now()}),a}catch(a){console.warn("Failed to fetch leaderboard from server:",a)}return this.getLocalLeaderboard(t,e)}async fetchFromServer(t,e){if(!this.apiEndpoint)return[];const i=await fetch(`${this.apiEndpoint}/leaderboard?type=${t}&limit=${e}`);return i.ok?(await i.json()).entries||[]:[]}getLocalLeaderboard(t,e){let i=[...this.localScores];if(t==="daily"){const s=this.getTodayString(),a=this.dailyChallenges.get(s);a?i=i.filter(n=>n.seed===a.seed):i=[]}return i.slice(0,e)}async loadTodaysChallenge(){const t=this.getTodayString();if(this.dailyChallenges.has(t))return;try{const i=await fetch(`${this.apiEndpoint}/daily-challenge?date=${t}`);if(i.ok){const s=await i.json();this.dailyChallenges.set(t,s),this.saveLocalData();return}}catch(i){console.warn("Failed to load daily challenge from server:",i)}const e={date:t,seed:this.generateDailySeed(t),leaderboard:[],playerBest:null,ghostRace:null};this.dailyChallenges.set(t,e),this.saveLocalData()}getDailyChallenge(){const t=this.getTodayString();return this.dailyChallenges.get(t)||null}async getGhostRace(t){try{const s=await fetch(`${this.apiEndpoint}/ghost-race?seed=${t}`);if(s.ok)return(await s.json()).ghost}catch(s){console.warn("Failed to load ghost race:",s)}const e=this.getTodayString(),i=this.dailyChallenges.get(e);return(i==null?void 0:i.ghostRace)||null}createGhostPlayer(t){return new E(t)}generateSessionId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}generatePlayerName(){const t=["Swift","Brave","Clever","Quick","Happy","Lucky","Mighty","Noble"],e=["Dog","Wolf","Fox","Eagle","Hawk","Lion","Tiger","Bear"],i=t[Math.floor(Math.random()*t.length)],s=e[Math.floor(Math.random()*e.length)],a=Math.floor(Math.random()*1e3);return`${i}${s}${a}`}generateEntryId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}generateNonce(){return Math.random().toString(36).substr(2,15)}generateDailySeed(t){return this.simpleHash(t+"flappydog-daily").substr(0,8)}getTodayString(){const t=new Date;return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}simpleHash(t){let e=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);e=(e<<5)-e+s,e=e&e}return Math.abs(e).toString(36)}setPlayerName(t){this.playerName=t,localStorage.setItem("flappydog-playername",t)}getPlayerName(){return this.playerName}getLocalBestScore(){return this.localScores.length>0?this.localScores[0].score:0}clearLocalData(){this.localScores=[],this.dailyChallenges.clear(),this.leaderboardCache.clear(),localStorage.removeItem("flappydog-local-scores"),localStorage.removeItem("flappydog-daily-challenges")}}class E{constructor(t){this.startTime=0,this.playing=!1,this.currentPositionIndex=0,this.currentEventIndex=0,this.ghostData=t}start(){this.startTime=Date.now(),this.playing=!0,this.currentPositionIndex=0,this.currentEventIndex=0}stop(){this.playing=!1}isPlaying(){return this.playing}getCurrentPosition(){if(!this.playing)return null;const t=Date.now()-this.startTime;for(;this.currentPositionIndex<this.ghostData.positions.length-1&&!(this.ghostData.positions[this.currentPositionIndex+1].time>t);)this.currentPositionIndex++;if(this.currentPositionIndex>=this.ghostData.positions.length)return this.playing=!1,null;const e=this.ghostData.positions[this.currentPositionIndex],i=this.ghostData.positions[this.currentPositionIndex+1];if(i){const s=(t-e.time)/(i.time-e.time),a=Math.max(0,Math.min(1,s));return{x:e.x+(i.x-e.x)*a,y:e.y+(i.y-e.y)*a,rotation:e.rotation+(i.rotation-e.rotation)*a}}return{x:e.x,y:e.y,rotation:e.rotation}}getNextEvent(){if(!this.playing)return null;const t=Date.now()-this.startTime;if(this.currentEventIndex<this.ghostData.events.length){const e=this.ghostData.events[this.currentEventIndex];if(e.time<=t)return this.currentEventIndex++,{type:e.type,data:e.data}}return null}getProgress(){if(!this.playing)return 0;const t=Date.now()-this.startTime;return Math.min(1,t/this.ghostData.duration)}}class f{static createDogSprite(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=144,t.height=32,e.clearRect(0,0,t.width,t.height);const i="#D2B48C",s="#A0522D",a="#FFFFFF",n="#000000",o=(h,c,r,m=0)=>{e.fillStyle=r,e.fillRect(h+m,c,1,1)};for(let h=0;h<3;h++){const c=h*48,r=h===1?14:h===2?18:16;for(let d=8;d<40;d++)for(let g=8;g<24;g++){const x=(d-24)/16,w=(g-16)/8;x*x+w*w<1&&o(d,g,i,c)}for(let d=20;d<44;d++)for(let g=4;g<20;g++)Math.sqrt((d-32)**2+(g-12)**2)<10&&o(d,g,i,c);for(let d=20;d<28;d++)for(let g=2;g<12;g++)d-20>=g-2&&o(d,g,s,c);for(let d=28;d<36;d++)for(let g=8;g<16;g++){const y=Math.sqrt((d-32)**2+(g-12)**2);y<3&&o(d,g,a,c),y<1.5&&o(d,g,n,c)}o(38,12,n,c),o(39,12,n,c),o(38,13,n,c),o(37,14,n,c),o(38,15,n,c),[[6,16],[5,17],[4,18],[4,19],[5,20],[6,21],[7,22]].forEach(([d,g])=>o(d,g,s,c)),(h===0?[[12,r],[13,r],[14,r],[11,r+1],[12,r+1],[13,r+1]]:h===1?[[10,r],[11,r],[12,r],[13,r],[9,r+1],[10,r+1],[11,r+1]]:[[12,r],[13,r],[14,r],[15,r],[13,r+1],[14,r+1],[15,r+1]]).forEach(([d,g])=>o(d,g,s,c)),o(16,22,s,c),o(17,23,s,c),o(24,22,s,c),o(25,23,s,c)}return t.toDataURL("image/png")}static createObstacleSprite(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=80,t.height=400,e.clearRect(0,0,t.width,t.height);const i="#87CEEB",s="#4682B4";for(let a=0;a<t.height;a++)for(let n=0;n<t.width;n++){const o=Math.sin(n*.1)*Math.cos(a*.1)+Math.sin(n*.05)*Math.cos(a*.05);if(o>.3){const h=Math.min(1,o);e.fillStyle=i,e.globalAlpha=h,e.fillRect(n,a,1,1)}}e.globalAlpha=1,e.strokeStyle=s,e.lineWidth=2,e.beginPath();for(let a=0;a<t.height;a+=2){const n=5+Math.sin(a*.02)*3;t.width-5-Math.sin(a*.02)*3,a===0?e.moveTo(n,a):e.lineTo(n,a)}for(let a=t.height;a>0;a-=2){const n=t.width-5-Math.sin(a*.02)*3;e.lineTo(n,a)}return e.closePath(),e.stroke(),t.toDataURL("image/png")}static createBoneSprite(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=24,t.height=24,e.clearRect(0,0,t.width,t.height);const i="#FFF8DC",s="#DDD";return e.fillStyle=i,e.strokeStyle=s,e.lineWidth=1,e.fillRect(6,10,12,4),e.strokeRect(6,10,12,4),e.beginPath(),e.ellipse(6,8,3,6,0,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.ellipse(6,16,3,6,0,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.ellipse(18,8,3,6,0,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.ellipse(18,16,3,6,0,0,Math.PI*2),e.fill(),e.stroke(),t.toDataURL("image/png")}static createCoinSprite(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=24,t.height=24,e.clearRect(0,0,t.width,t.height);const i=e.createRadialGradient(12,12,0,12,12,12);return i.addColorStop(0,"#FFD700"),i.addColorStop(.7,"#FFA500"),i.addColorStop(1,"#FF8C00"),e.fillStyle=i,e.beginPath(),e.arc(12,12,10,0,Math.PI*2),e.fill(),e.strokeStyle="#B8860B",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.6)",e.beginPath(),e.arc(8,8,3,0,Math.PI*2),e.fill(),e.fillStyle="#B8860B",e.font="bold 12px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText("â˜…",12,12),t.toDataURL("image/png")}static createCloudSprite(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=120,t.height=60,e.clearRect(0,0,t.width,t.height);const i="rgba(255, 255, 255, 0.8)";return e.fillStyle=i,e.beginPath(),e.arc(30,35,20,0,Math.PI*2),e.arc(50,30,25,0,Math.PI*2),e.arc(70,35,20,0,Math.PI*2),e.arc(90,40,15,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(25,25,12,0,Math.PI*2),e.arc(75,25,15,0,Math.PI*2),e.arc(95,30,10,0,Math.PI*2),e.fill(),t.toDataURL("image/png")}static createPWAIcon(t){const e=document.createElement("canvas"),i=e.getContext("2d");e.width=t,e.height=t;const s=i.createLinearGradient(0,0,0,t);s.addColorStop(0,"#87CEEB"),s.addColorStop(1,"#4682B4"),i.fillStyle=s,i.fillRect(0,0,t,t);const a=t/2,n=t/2,o=t*.3;return i.fillStyle="#D2B48C",i.beginPath(),i.arc(a,n,o,0,Math.PI*2),i.fill(),i.fillStyle="#A0522D",i.beginPath(),i.arc(a-o*.5,n-o*.5,o*.4,0,Math.PI*2),i.fill(),i.fillStyle="#FFFFFF",i.beginPath(),i.arc(a+o*.2,n-o*.2,o*.2,0,Math.PI*2),i.fill(),i.fillStyle="#000000",i.beginPath(),i.arc(a+o*.2,n-o*.2,o*.1,0,Math.PI*2),i.fill(),i.fillStyle="#000000",i.beginPath(),i.arc(a+o*.4,n,o*.08,0,Math.PI*2),i.fill(),e.toDataURL("image/png")}}const M={dog:f.createDogSprite(),obstacle:f.createObstacleSprite(),bone:f.createBoneSprite(),coin:f.createCoinSprite(),cloud:f.createCloudSprite()},v={icon192:f.createPWAIcon(192),icon512:f.createPWAIcon(512),favicon:f.createPWAIcon(32)};function A(){const l=document.querySelector('link[rel="icon"]');if(l)l.href=v.favicon;else{const t=document.createElement("link");t.rel="icon",t.type="image/png",t.href=v.favicon,document.head.appendChild(t)}}function L(){const l=document.createElement("canvas"),t=l.getContext("2d");l.width=1200,l.height=630;const e=t.createLinearGradient(0,0,0,l.height);e.addColorStop(0,"#87CEEB"),e.addColorStop(1,"#4682B4"),t.fillStyle=e,t.fillRect(0,0,l.width,l.height),t.fillStyle="#FFFFFF",t.font="bold 120px Arial",t.textAlign="center",t.textBaseline="middle",t.strokeStyle="#000000",t.lineWidth=4;const i="ðŸ• FlappyDog";t.strokeText(i,l.width/2,l.height/2-50),t.fillText(i,l.width/2,l.height/2-50),t.font="bold 48px Arial";const s="The Ultimate Flappy Experience";t.strokeText(s,l.width/2,l.height/2+50),t.fillText(s,l.width/2,l.height/2+50),t.font="32px Arial",t.fillStyle="#FFD700";const a="ðŸŽµ Rhythm Mode â€¢ ðŸŒªï¸ Wind System â€¢ ðŸ† Daily Challenges â€¢ ðŸ“± PWA";return t.fillText(a,l.width/2,l.height/2+150),l.toDataURL("image/png")}const p=800,u=600,b=.6,F=-12,R=.3,G=8,P=8e3,D=.15;class B{constructor(){this.lastTime=0,this.deltaTime=0,this.gameState="menu",this.gameMode="classic",this.obstacles=[],this.collectibles=[],this.particles=[],this.score=0,this.bestScore=0,this.superWagMeter=0,this.dashCooldown=0,this.wind=null,this.perfectBeatStreak=0,this.bulletTimeRemaining=0,this.keys=new Set,this.mousePressed=!1,this.touchPressed=!1,this.lastTapTime=0,this.doubleTapWindow=300,this.sprites=new Map,this.spritesLoaded=0,this.totalSprites=0,this.settings={soundVolume:.7,musicVolume:.5,haptics:!0,colorblind:!1,highContrast:!1,leftHandMode:!1,motionReduced:!1,screenShake:!0,rhythmAssist:!0},this.recentFailures=0,this.difficultyMultiplier=1,this.dailySeed="",this.ghostData=[],this.recordingGhost=!1,this._activeQuests=[],this._completedCosmetics=new Set,this.frameCount=0,this.fps=60,this._targetFps=60,this.gameLoop=(t=0)=>{this.deltaTime=t-this.lastTime,this.lastTime=t,this.deltaTime=Math.min(this.deltaTime,50),this.frameCount++,this.frameCount%60===0&&(this.fps=Math.round(1e3/(this.deltaTime||16.67))),this.update(this.deltaTime),this.render(),requestAnimationFrame(this.gameLoop)},this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.audioManager=new I,this.uiManager=new k,this.leaderboardManager=new T,this.dog=this.createDog(),this.setupCanvas(),this.loadSettings(),this.setupEventListeners(),this.generateDailySeed(),this.initializeQuests(),A(),this.generateSocialImage(),this.loadAssets()}setupCanvas(){this.canvas.width=p,this.canvas.height=u;const t=window.devicePixelRatio||1,e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*t,this.canvas.height=e.height*t,this.ctx.scale(t,t),this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.canvas.style.display="block",this.canvas.style.imageRendering="pixelated"}createDog(){return{position:{x:p*.2,y:u*.5},velocity:{x:0,y:0},width:48,height:32,active:!0,rotation:0,flapAnimation:0,blinkTimer:0,invulnerable:!1,superWagActive:!1}}setupEventListeners(){window.addEventListener("keydown",t=>{this.keys.add(t.code),this.handleInput(t.code)}),window.addEventListener("keyup",t=>{this.keys.delete(t.code)}),this.canvas.addEventListener("mousedown",t=>{t.preventDefault(),this.mousePressed=!0,this.handleInput("mouse")}),window.addEventListener("mouseup",()=>{this.mousePressed=!1}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.touchPressed=!0;const e=Date.now();e-this.lastTapTime<this.doubleTapWindow&&this.handleDoubleTap(),this.lastTapTime=e,this.handleInput("touch")}),this.canvas.addEventListener("touchend",t=>{t.preventDefault(),this.touchPressed=!1}),this.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),document.addEventListener("visibilitychange",()=>{document.hidden?(this._targetFps=30,this.gameState==="playing"&&(this.gameState="paused")):this._targetFps=60})}handleInput(t){if(this.gameState==="menu"){this.startGame();return}this.gameState==="playing"&&((t==="Space"||t==="ArrowUp"||t==="mouse"||t==="touch")&&this.flap(),t==="Escape"&&this.pauseGame()),this.gameState==="paused"&&(t==="Space"||t==="mouse"||t==="touch")&&this.resumeGame(),this.gameState==="gameover"&&(t==="Space"||t==="mouse"||t==="touch")&&this.restartGame()}handleDoubleTap(){this.gameState==="playing"&&this.dashCooldown<=0&&this.dash()}flap(){this.bulletTimeRemaining>0?this.dog.velocity.y=F*1.3:this.dog.velocity.y=F,this.dog.flapAnimation=.3,this.dog.rotation=-30,this.gameMode==="rhythm"&&(this.audioManager.isOnBeat()?(this.perfectBeatStreak++,this.addParticles(this.dog.position,"gold",5),this.score+=1):this.perfectBeatStreak=0),this.superWagMeter=Math.min(100,this.superWagMeter+10),this.superWagMeter>=100&&this.keys.has("Space")&&this._barkPulse(),this.settings.screenShake&&!this.settings.motionReduced&&this.addScreenShake(2),this.settings.haptics&&"vibrate"in navigator&&navigator.vibrate(50),this.audioManager.playSound("flap"),this.addParticles(this.dog.position,"white",3)}dash(){this.dog.velocity.x=G,this.dashCooldown=P,this.addParticles(this.dog.position,"blue",8),this.settings.screenShake&&!this.settings.motionReduced&&this.addScreenShake(5),this.settings.haptics&&"vibrate"in navigator&&navigator.vibrate([100,50,100]),this.audioManager.playSound("dash")}_barkPulse(){this.superWagMeter>=100&&(this.bulletTimeRemaining=2e3,this.dog.invulnerable=!0,this.dog.superWagActive=!0,this.superWagMeter=0,this.obstacles.forEach(t=>{if(this.getDistance(this.dog.position,t.position)<150){const i=this.normalize({x:t.position.x-this.dog.position.x,y:t.position.y-this.dog.position.y});t.position.x+=i.x*20,t.position.y+=i.y*10}}),this.collectibles.forEach(t=>{if(t.type==="coin"&&!t.collected&&this.getDistance(this.dog.position,t.position)<100){const i=this.normalize({x:this.dog.position.x-t.position.x,y:this.dog.position.y-t.position.y});t.velocity.x=i.x*5,t.velocity.y=i.y*5}}),this.addParticles(this.dog.position,"yellow",15),this.audioManager.playSound("bark"))}startGame(){var t,e;this.gameState="playing",this.score=0,this.superWagMeter=0,this.dashCooldown=0,this.perfectBeatStreak=0,this.bulletTimeRemaining=0,this.dog=this.createDog(),this.obstacles=[],this.collectibles=[],this.particles=[],this.dailySeed&&(this.recordingGhost=!0,this.ghostData=[]),this.gameMode==="rhythm"?this.audioManager.playMusic("rhythm1"):this.audioManager.playMusic("ambient"),(t=document.getElementById("loading"))==null||t.classList.add("hidden"),this.canvas.classList.remove("hidden"),(e=document.getElementById("uiOverlay"))==null||e.classList.remove("hidden")}pauseGame(){this.gameState==="playing"&&(this.gameState="paused",this.audioManager.pauseMusic())}resumeGame(){this.gameState==="paused"&&(this.gameState="playing",this.audioManager.resumeMusic())}restartGame(){this.gameState="menu",this.audioManager.stopMusic(),this.uiManager.showMenu()}gameOver(){this.gameState="gameover",this.audioManager.stopMusic(),this.audioManager.playSound("gameover"),this.score>this.bestScore&&(this.bestScore=this.score,this.saveSettings(),this.addParticles({x:p/2,y:u/2},"rainbow",20)),this.score<10?this.recentFailures++:this.recentFailures=Math.max(0,this.recentFailures-1),this.updateDifficultyMultiplier(),this.uiManager.showGameOver(this.score,this.bestScore),this.updateQuests()}updateDifficultyMultiplier(){this.recentFailures>=3?this.difficultyMultiplier=Math.max(.7,this.difficultyMultiplier-.1):this.recentFailures===0&&this.score>20&&(this.difficultyMultiplier=Math.min(1.3,this.difficultyMultiplier+.05))}update(t){if(this.gameState!=="playing")return;const e=this.bulletTimeRemaining>0?t*.6:t;this.updateDog(e),this.updateObstacles(e),this.updateCollectibles(e),this.updateParticles(e),this.updateWind(e),this.updateTimers(e),this.checkCollisions(),this.spawnObjects(),this.recordingGhost&&this.ghostData.push({time:Date.now(),position:{...this.dog.position}})}updateDog(t){const e=this.isGliding()?b*R:b;this.dog.velocity.y+=e*(t/16.67),this.wind&&(this.dog.velocity.x+=this.wind.direction.x*this.wind.strength*(t/16.67),this.dog.velocity.y+=this.wind.direction.y*this.wind.strength*(t/16.67)),this.dog.position.x+=this.dog.velocity.x*(t/16.67),this.dog.position.y+=this.dog.velocity.y*(t/16.67),this.dog.velocity.x*=.95,this.dog.rotation=Math.max(-45,Math.min(45,this.dog.velocity.y*2)),this.dog.flapAnimation=Math.max(0,this.dog.flapAnimation-t/1e3),this.dog.blinkTimer+=t,this.dog.blinkTimer>3e3&&(this.dog.blinkTimer=0),this.dog.position.y<0&&(this.dog.position.y=0,this.dog.velocity.y=0),this.dog.position.y>u-this.dog.height&&this.gameOver()}updateObstacles(t){for(let e=this.obstacles.length-1;e>=0;e--){const i=this.obstacles[e];i.position.x-=200*(t/1e3),!i.passed&&i.position.x+i.width<this.dog.position.x&&(i.passed=!0,this.score++,this.audioManager.playSound("score"),this.addParticles({x:i.position.x+i.width,y:i.gapY},"green",3)),i.position.x+i.width<0&&this.obstacles.splice(e,1)}}updateCollectibles(t){for(let e=this.collectibles.length-1;e>=0;e--){const i=this.collectibles[e];i.collected||(i.position.x-=200*(t/1e3),i.position.x+=i.velocity.x*(t/1e3),i.position.y+=i.velocity.y*(t/1e3),i.velocity.x*=.98,i.velocity.y*=.98),i.position.x+i.width<0&&this.collectibles.splice(e,1)}}updateParticles(t){for(let e=this.particles.length-1;e>=0;e--){const i=this.particles[e];i.position.x+=i.velocity.x*(t/1e3),i.position.y+=i.velocity.y*(t/1e3),i.life-=t,i.life<=0&&this.particles.splice(e,1)}}updateWind(t){if(!this.wind||this.wind.elapsed>=this.wind.duration){const e=(Math.random()-.5)*Math.PI;this.wind={strength:D*(.5+Math.random()*.5),direction:{x:Math.cos(e),y:Math.sin(e)*.3},duration:2e3+Math.random()*3e3,elapsed:0},this.addWindParticles()}if(this.wind){this.wind.elapsed+=t;const e=this.wind.elapsed/this.wind.duration,i=Math.sin(e*Math.PI);this.wind.strength=D*i*this.difficultyMultiplier}}addWindParticles(){if(this.wind)for(let t=0;t<10;t++){const e=Math.random()*p,i=Math.random()*u;this.particles.push({position:{x:e,y:i},velocity:{x:this.wind.direction.x*100,y:this.wind.direction.y*50},life:1e3+Math.random()*500,maxLife:1500,color:"rgba(255, 255, 255, 0.3)",size:1+Math.random()*2})}}updateTimers(t){this.dashCooldown=Math.max(0,this.dashCooldown-t),this.bulletTimeRemaining=Math.max(0,this.bulletTimeRemaining-t),this.bulletTimeRemaining===0&&this.dog.superWagActive&&(this.dog.superWagActive=!1,this.dog.invulnerable=!1)}checkCollisions(){if(!this.dog.invulnerable){for(const t of this.obstacles)if(this.isColliding(this.dog,t)){this.gameOver();return}for(const t of this.collectibles)!t.collected&&this.isColliding(this.dog,t)&&this.collectItem(t)}}collectItem(t){switch(t.collected=!0,t.type){case"bone":this.superWagMeter=Math.min(100,this.superWagMeter+20),this.audioManager.playSound("bone"),this.addParticles(t.position,"bone-white",5);break;case"coin":this.score+=t.value,this.audioManager.playSound("coin"),this.addParticles(t.position,"gold",8);break;case"checkpoint":this.audioManager.playSound("checkpoint"),this.addParticles(t.position,"rainbow",12);break}this.settings.haptics&&"vibrate"in navigator&&navigator.vibrate(100)}spawnObjects(){(this.obstacles.length===0||this.obstacles[this.obstacles.length-1].position.x<p-300)&&this.spawnObstacle(),Math.random()<.02*(this.deltaTime/16.67)&&this.spawnCollectible()}spawnObstacle(){const t=180*this.difficultyMultiplier,e=100+Math.random()*(u-200-t);let i=p+50;if(this.gameMode==="rhythm"){const a=this.audioManager.getNextBeatTime();i=p+a*200}const s={position:{x:i,y:0},velocity:{x:0,y:0},width:80,height:u,active:!0,passed:!1,gapY:e,gapSize:t};this.obstacles.push(s)}spawnCollectible(){const t=Math.random()<.6?"bone":"coin",e=p+100+Math.random()*200,i=50+Math.random()*(u-100);let s=1;t==="coin"&&(s=this.obstacles.some(o=>Math.abs(o.position.x-e)<150&&Math.abs(o.gapY-i)<100)?3:1);const a={position:{x:e,y:i},velocity:{x:0,y:0},width:24,height:24,active:!0,type:t,value:s,collected:!1};this.collectibles.push(a)}render(){this.ctx.fillStyle=this.getBackgroundGradient(),this.ctx.fillRect(0,0,p,u),this.drawParallaxBackground(),this.drawWindParticles(),this.obstacles.forEach(t=>this.drawObstacle(t)),this.collectibles.forEach(t=>{t.collected||this.drawCollectible(t)}),this.particles.forEach(t=>this.drawParticle(t)),this.drawDog(),this.drawUI()}getBackgroundGradient(){const t=this.ctx.createLinearGradient(0,0,0,u);return this.settings.highContrast?(t.addColorStop(0,"#000000"),t.addColorStop(1,"#333333")):this.settings.colorblind?(t.addColorStop(0,"#4A90E2"),t.addColorStop(1,"#2C5282")):(t.addColorStop(0,"#87CEEB"),t.addColorStop(1,"#4682B4")),t}drawParallaxBackground(){if(this.settings.motionReduced)return;const t=Date.now()*.02%p;this.ctx.fillStyle="rgba(255, 255, 255, 0.3)";for(let e=0;e<5;e++){const i=(e*200-t)%(p+100),s=50+e*30%150;this.drawCloud(i,s,60+e*10)}}drawCloud(t,e,i){this.ctx.save(),this.ctx.globalAlpha=.6,this.ctx.fillStyle="#FFFFFF",this.ctx.beginPath(),this.ctx.arc(t,e,i*.5,0,Math.PI*2),this.ctx.arc(t+i*.3,e,i*.4,0,Math.PI*2),this.ctx.arc(t-i*.3,e,i*.4,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawWindParticles(){if(!(!this.wind||this.settings.motionReduced)){this.ctx.save(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=2;for(let t=0;t<10;t++){const e=(t*80+Date.now()*.1)%p,i=100+t*50%(u-200);this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(e+this.wind.direction.x*20,i+this.wind.direction.y*20),this.ctx.stroke()}this.ctx.restore()}}drawObstacle(t){this.ctx.save();const e=this.sprites.get("obstacle");e?(this.ctx.drawImage(e,t.position.x,0,t.width,t.gapY),this.ctx.drawImage(e,0,t.gapY+t.gapSize,t.width,u-(t.gapY+t.gapSize),t.position.x,t.gapY+t.gapSize,t.width,u-(t.gapY+t.gapSize))):(this.ctx.fillStyle=this.settings.colorblind?"#FF6B6B":"#90EE90",this.ctx.strokeStyle="#228B22",this.ctx.lineWidth=3,this.drawRoundedRect(t.position.x,0,t.width,t.gapY,10),this.drawRoundedRect(t.position.x,t.gapY+t.gapSize,t.width,u-(t.gapY+t.gapSize),10)),this.getDistance(this.dog.position,{x:t.position.x+t.width/2,y:t.gapY+t.gapSize/2})<150&&(this.ctx.shadowColor=this.dog.superWagActive?"#FFD700":"#87CEEB",this.ctx.shadowBlur=10),this.ctx.restore()}drawCollectible(t){this.ctx.save();const e=t.position.x+t.width/2,i=t.position.y+t.height/2,s=Math.sin(Date.now()*.005+e*.01)*3;if(this.ctx.translate(e,i+s),t.type==="coin"){const o=Date.now()*.003;this.ctx.rotate(o)}const a=t.type==="bone"?"bone":"coin",n=this.sprites.get(a);if(n)this.ctx.drawImage(n,-t.width/2,-t.height/2,t.width,t.height),t.type==="coin"&&t.value>1&&this.addSparkleEffect();else if(t.type==="bone")this.ctx.fillStyle="#FFF8DC",this.ctx.strokeStyle="#DDD",this.drawBone();else if(t.type==="coin"){const o=t.value>1;this.ctx.fillStyle=o?"#FFD700":"#FFA500",this.ctx.strokeStyle=o?"#B8860B":"#FF8C00",this.drawCoin(o)}this.ctx.restore()}addSparkleEffect(){this.ctx.fillStyle="#FFFFFF";for(let t=0;t<4;t++){const e=t/4*Math.PI*2+Date.now()*.01,i=Math.cos(e)*15,s=Math.sin(e)*15;this.ctx.fillRect(i-1,s-1,2,2)}}drawBone(){this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.ellipse(-8,0,4,8,0,0,Math.PI*2),this.ctx.ellipse(8,0,4,8,0,0,Math.PI*2),this.ctx.rect(-8,-2,16,4),this.ctx.fill(),this.ctx.stroke()}drawCoin(t){if(this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(0,0,t?12:10,0,Math.PI*2),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(-3,-3,3,0,Math.PI*2),this.ctx.fill(),t){this.ctx.fillStyle="#FFFFFF";for(let e=0;e<4;e++){const i=e/4*Math.PI*2+Date.now()*.01,s=Math.cos(i)*15,a=Math.sin(i)*15;this.ctx.fillRect(s-1,a-1,2,2)}}}drawDog(){this.ctx.save();const t=this.dog.position.x+this.dog.width/2,e=this.dog.position.y+this.dog.height/2;this.ctx.translate(t,e),this.ctx.rotate(this.dog.rotation*Math.PI/180);const i=1-this.dog.flapAnimation*.3;this.ctx.scale(1,i),this.dog.superWagActive&&(this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=20),this.dog.invulnerable&&(this.ctx.globalAlpha=.5+Math.sin(Date.now()*.02)*.3);const s=this.sprites.get("dog");if(s){const a=Math.floor(this.dog.flapAnimation*3)%3;this.ctx.drawImage(s,a*48,0,48,32,-this.dog.width/2,-this.dog.height/2,this.dog.width,this.dog.height)}else this.drawFallbackDog();this.ctx.restore()}drawFallbackDog(){this.ctx.fillStyle="#D2B48C",this.ctx.fillRect(-24,-16,48,32),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(8,-8,8,8),this.ctx.fillStyle="#000000";const e=4*(1-Math.max(0,1-Math.abs(this.dog.blinkTimer-150)/50));this.ctx.fillRect(10,-6,4,e),this.ctx.fillStyle="#000000",this.ctx.fillRect(20,-2,4,4),this.ctx.fillStyle="#A0522D",this.ctx.fillRect(-20,-12,12,8)}drawParticle(t){this.ctx.save();const e=t.life/t.maxLife;if(this.ctx.globalAlpha=e,t.color==="rainbow"){const i=(Date.now()*.5+t.position.x)%360;this.ctx.fillStyle=`hsl(${i}, 100%, 50%)`}else this.ctx.fillStyle=t.color;this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,t.size,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawUI(){this.ctx.save(),this.ctx.font="24px monospace",this.ctx.fillStyle=this.settings.highContrast?"#FFFFFF":"#000000",this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=3;const t=`Score: ${this.score}`;if(this.ctx.strokeText(t,20,40),this.ctx.fillText(t,20,40),this.bestScore>0){const e=`Best: ${this.bestScore}`;this.ctx.strokeText(e,20,70),this.ctx.fillText(e,20,70)}this.drawSuperWagMeter(),this.dashCooldown>0&&this.drawDashCooldown(),this.gameMode==="rhythm"&&this.perfectBeatStreak>0&&this.drawBeatStreak(),this.bulletTimeRemaining>0&&this.drawBulletTimeIndicator(),this.ctx.restore()}drawSuperWagMeter(){const t=p-120,e=30,i=100,s=10;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t,e,i,s);const a=this.superWagMeter/100*i;this.ctx.fillStyle=this.superWagMeter>=100?"#FFD700":"#FFA500",this.ctx.fillRect(t,e,a,s),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,i,s),this.ctx.font="12px monospace",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("SUPER WAG",t,e-5)}drawDashCooldown(){const t=p-120,e=60,i=1-this.dashCooldown/P;this.ctx.fillStyle="rgba(0, 0, 255, 0.7)",this.ctx.beginPath(),this.ctx.arc(t+50,e,15,-Math.PI/2,-Math.PI/2+i*Math.PI*2),this.ctx.lineTo(t+50,e),this.ctx.fill(),this.ctx.font="10px monospace",this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center",this.ctx.fillText("DASH",t+50,e+25),this.ctx.textAlign="left"}drawBeatStreak(){this.ctx.font="18px monospace",this.ctx.fillStyle="#FFD700",this.ctx.strokeStyle="#B8860B",this.ctx.lineWidth=2;const t=`â™ª ${this.perfectBeatStreak} STREAK â™ª`,e=p/2-this.ctx.measureText(t).width/2;this.ctx.strokeText(t,e,100),this.ctx.fillText(t,e,100)}drawBulletTimeIndicator(){const t=this.bulletTimeRemaining/2e3;this.ctx.fillStyle=`rgba(255, 215, 0, ${.1*t})`,this.ctx.fillRect(0,0,p,u);const e=50,i=u-50,s=p-100,a=8;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(e,i,s,a),this.ctx.fillStyle="#FFD700",this.ctx.fillRect(e,i,s*t,a),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(e,i,s,a),this.ctx.font="14px monospace",this.ctx.fillStyle="#FFD700",this.ctx.fillText("BULLET TIME",e,i-10)}drawDebugInfo(){this.ctx.font="12px monospace",this.ctx.fillStyle="#00FF00",[`FPS: ${this.fps}`,`Difficulty: ${this.difficultyMultiplier.toFixed(2)}`,`Wind: ${this.wind?this.wind.strength.toFixed(2):"None"}`,`Objects: ${this.obstacles.length+this.collectibles.length}`,`Particles: ${this.particles.length}`].forEach((e,i)=>{this.ctx.fillText(e,20,u-100+i*15)})}drawRoundedRect(t,e,i,s,a){this.ctx.beginPath(),this.ctx.moveTo(t+a,e),this.ctx.lineTo(t+i-a,e),this.ctx.quadraticCurveTo(t+i,e,t+i,e+a),this.ctx.lineTo(t+i,e+s-a),this.ctx.quadraticCurveTo(t+i,e+s,t+i-a,e+s),this.ctx.lineTo(t+a,e+s),this.ctx.quadraticCurveTo(t,e+s,t,e+s-a),this.ctx.lineTo(t,e+a),this.ctx.quadraticCurveTo(t,e,t+a,e),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}isGliding(){return this.keys.has("Space")||this.mousePressed||this.touchPressed}isColliding(t,e){return t.position.x+2<e.position.x+e.width&&t.position.x+t.width-2>e.position.x&&t.position.y+2<e.position.y+e.height&&t.position.y+t.height-2>e.position.y}getDistance(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}normalize(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}}addParticles(t,e,i){for(let s=0;s<i;s++){const a=Math.random()*Math.PI*2,n=50+Math.random()*100;this.particles.push({position:{...t},velocity:{x:Math.cos(a)*n,y:Math.sin(a)*n},life:500+Math.random()*1e3,maxLife:1500,color:e,size:2+Math.random()*3})}}addScreenShake(t){if(!this.settings.screenShake||this.settings.motionReduced)return;const e=(Math.random()-.5)*t,i=(Math.random()-.5)*t;this.ctx.save(),this.ctx.translate(e,i),setTimeout(()=>{this.ctx.restore()},100)}generateDailySeed(){const t=new Date;this.dailySeed=`${t.getFullYear()}${(t.getMonth()+1).toString().padStart(2,"0")}${t.getDate().toString().padStart(2,"0")}`}initializeQuests(){this._activeQuests=[{id:"flap_master",description:"Pass 10 gates without gliding",progress:0,target:10,completed:!1,reward:"Golden Collar"},{id:"coin_collector",description:"Collect 5 coins in one run",progress:0,target:5,completed:!1,reward:"Sparkle Trail"},{id:"rhythm_master",description:"Get 15 perfect beats in rhythm mode",progress:0,target:15,completed:!1,reward:"Beat Wings"}]}updateQuests(){this._activeQuests.forEach(t=>{if(!t.completed){switch(t.id){case"flap_master":this.score>=t.progress+1&&!this.isGliding()&&(t.progress=Math.min(t.target,t.progress+1));break;case"coin_collector":const e=this.collectibles.filter(i=>i.collected&&i.type==="coin").length;t.progress=Math.min(t.target,e);break;case"rhythm_master":this.gameMode==="rhythm"&&(t.progress=Math.min(t.target,this.perfectBeatStreak));break}t.progress>=t.target&&!t.completed&&(t.completed=!0,this.completeQuest(t))}})}completeQuest(t){this.uiManager.showToast(`ðŸŽ‰ Quest Complete: ${t.reward}!`,"success",5e3),this.uiManager.unlockCosmetic(t.reward.toLowerCase().replace(" ","_")),this.audioManager.playSound("quest_complete"),this.addParticles({x:p/2,y:u/2},"rainbow",20),this.saveSettings()}loadAssets(){const t=Object.keys(M);this.totalSprites=t.length,t.forEach(e=>{const i=new Image;i.onload=()=>{this.sprites.set(e,i),this.spritesLoaded++,this.spritesLoaded===this.totalSprites&&this.onAssetsLoaded()},i.onerror=()=>{console.warn(`Failed to load generated asset: ${e}`),this.spritesLoaded++,this.spritesLoaded===this.totalSprites&&this.onAssetsLoaded()},i.src=M[e]})}onAssetsLoaded(){this.audioManager.initialize(),this.uiManager.initialize(this.canvas),this.leaderboardManager.initialize(),this.uiManager.showMenu(),this.gameLoop()}loadSettings(){const t=localStorage.getItem("flappydog-settings");t&&(this.settings={...this.settings,...JSON.parse(t)});const e=localStorage.getItem("flappydog-bestscore");e&&(this.bestScore=parseInt(e,10))}saveSettings(){localStorage.setItem("flappydog-settings",JSON.stringify(this.settings)),localStorage.setItem("flappydog-bestscore",this.bestScore.toString())}generateSocialImage(){const t=L();let e=document.querySelector('meta[property="og:image"]');e?e.content=t:(e=document.createElement("meta"),e.setAttribute("property","og:image"),e.content=t,document.head.appendChild(e));let i=document.querySelector('meta[name="twitter:image"]');i?i.content=t:(i=document.createElement("meta"),i.setAttribute("name","twitter:image"),i.content=t,document.head.appendChild(i))}setGameMode(t){this.gameMode=t}updateSettings(t){this.settings={...this.settings,...t},this.saveSettings()}getSettings(){return{...this.settings}}getDailyScore(){return{score:this.score,seed:this.dailySeed}}uploadCustomSprite(t){const e=new FileReader;e.onload=i=>{var a;const s=new Image;s.onload=()=>{this.sprites.set("dog",s)},s.src=(a=i.target)==null?void 0:a.result},e.readAsDataURL(t)}}document.addEventListener("DOMContentLoaded",()=>{new B});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(l=>{console.log("SW registered: ",l)}).catch(l=>{console.log("SW registration failed: ",l)})});
